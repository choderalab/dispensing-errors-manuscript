% PRL look and style (easy on the eyes)
\documentclass[aps,pre,twocolumn,nofootinbib,superscriptaddress,linenumbers]{revtex4-1}
% Two-column style (for submission/review/editing)
%\documentclass[aps,prl,preprint,nofootinbib,superscriptaddress,linenumbers]{revtex4-1}

\pdfoutput=1
\usepackage[pdftex]{graphicx}

\usepackage{alltt}

%\usepackage{palatino}

%\usepackage{palatino}
% Change to a sans serif font.
\usepackage{sourcesanspro}
\renewcommand*\familydefault{\sfdefault} %% Only if the base font of the document is to be sans serif
\usepackage[T1]{fontenc}
%\usepackage[font=sf,justification=justified]{caption}
\usepackage[font=sf]{floatrow}
% Change math font
\usepackage{sansmath}
\sansmath

% Rework captions to use sans serif font.
\makeatletter
\renewcommand\@make@capt@title[2]{%
 \@ifx@empty\float@link{\@firstofone}{\expandafter\href\expandafter{\float@link}}%
  {\sf\textbf{#1}}\sf\@caption@fignum@sep#2\quad
}%
\makeatother

\usepackage{listings} % For code examples
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}

% Break URLs in bibliography correctly
%\usepackage{biblatex}
%\usepackage{url}
%\setcounter{biburllcpenalty}{7000}
%\setcounter{biburlucpenalty}{8000}

\usepackage{amsmath}
\usepackage{amssymb}
%\usepackage[mathbf,mathcal]{euler}
%\usepackage{citesort}
\usepackage[caption=false]{subfig}
\usepackage{dcolumn}
\usepackage{boxedminipage}
\usepackage{verbatim}
\usepackage{url}
\def\UrlBreaks{\do\/\do-}
\usepackage{breakurl}
\usepackage[breaklinks,colorlinks=true,citecolor=blue,linkcolor=blue]{hyperref}
\usepackage[group-separator={,}]{siunitx}

%Strikethrough
\usepackage[normalem]{ulem}

% Justification
\captionsetup{singlelinecheck=off}

% Pretty-printing of shell commands
\newcommand{\shellcmd}[1]{\\\ \texttt{\scriptsize #1}}

% The figures are in a figures/ subdirectory.
\graphicspath{{../figures/}}

%% DOCUMENT %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

%% TITLE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{Modeling error in experimental assays using the bootstrap principle:\\
Understanding discrepancies between assays using different dispensing technologies}

\author{Sonya M. Hanson}
  \affiliation{Computational Biology Program, Sloan Kettering Institute, Memorial Sloan Kettering Cancer Center, New York, NY 10065, United States}
 \email{sonya.hanson@choderalab.org}
\author{Sean Ekins}
  \affiliation{Collaborations in Chemistry, Fuquay-Varina, NC 27526, United States}
   \email{https://about.me/Sean_Ekins}
\author{John D. Chodera}
 \thanks{Corresponding author}
 \email{john.chodera@choderalab.org}
  \affiliation{Computational Biology Program, Sloan Kettering Institute, Memorial Sloan Kettering Cancer Center, New York, NY 10065, United States}

\date{\today}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ABSTRACT/pacs
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}

All experimental assay data contains error, but the magnitude, type, and primary origin of this error is often not obvious.
Here, we describe a simple set of assay modeling techniques based on the bootstrap principle that allow sources of error and bias to be simulated and propagated into assay results.
We demonstrate how deceptively simple operations---such as the creation of a dilution series with a robotic liquid handler---can significantly amplify imprecision and even contribute substantially to bias.
To illustrate these techniques, we review an example of how the choice of dispensing technology can impact assay measurements, and show how large contributions to discrepancies between assays can be easily understood and potentially corrected for.
These simple modeling techniques---illustrated with an accompanying IPython notebook---can allow modelers to understand the expected error and bias in experimental datasets, and even help experimentalists design assays to more effectively reach accuracy and imprecision goals.

\emph{Keywords: error modeling; assay modeling; Bootstrap principle; dispensing technologies; liquid handling; direct dispensing; acoustic droplet ejection}
\end{abstract}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% INTRODUCTION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
\label{section:introduction}

Measuring the activity and potency of compounds---whether in biophysical or cell-based assays---is an important tool in the understanding of biological processes.
However, understanding assay data for the purpose of optimizing small molecules for use as chemical probes or potential therapeutics is complicated by the fact that all assay data are contaminated with error from numerous sources.

Often, the dominant contributions to assay error are simply not known.
This is unsurprising, given the number and variety of potential contributing factors.
Even for what might be considered a straightforward assay involving fluorescent measurements of a ligand binding to a protein target, this might include (but is by no means limited to): compound impurities and degradation~\cite{kozikowski_effect_2003,kozikowski_effect_2003-1,cheng_studies_2003,waybright_overcoming_2009}, imprecise compound dispensing  ~\cite{harris_gradient_2010,grant_achieving_2009}, unmonitored water absorption by DMSO stocks ~\cite{waybright_overcoming_2009}, the effect of DMSO on protein stability~\cite{tjernberg_dmso-related_2005}, intrinsic compound fluorescence~\cite{simeonov_fluorescence_2008,baell_new_2010}, compound insolubility~\cite{di_biological_2006} or aggregation~\cite{mcgovern_common_2002,mcgovern_kinase_2003,feng_high-throughput_2005,feng_synergy_2006,baell_new_2010}, variability in protein concentration or quality, pipetting errors, and inherent noise in any fluorescence measurement---not to mention stray lab coat fibers as fluorescent contaminants~\cite{busch_does_2015}. 
Under ideal circumstances, control experiments would be performed to measure the magnitude of these effects, and data quality tests would either reject flawed data or ensure that all contributions to error have been carefully accounted for in producing an assessment of error and confidence for each assayed value.
Multiple independent replicates of the experiment would ideally be performed to verify the true uncertainty and replicability of the assay data\footnote{Care must be taken to distinguish between fully independent replicates and partial replicates that only repeat part of the experiment (for example, repeated measurements performed using the same stock solutions), since partial measurements can often underestimate true error by orders of magnitude~\cite{chodera_entropy-enthalpy_2013}.}.

Unfortunately, by the time the data reach the hands of a computational chemist (or other data consumer), the opportunity to perform these careful control experiments has usually long passed.
In the worst case, the communicated assay data may not contain any estimate of error at all.
Even when error has been estimated, it is often not based on a holistic picture of the assay, but may instead reflect historical estimates of error or statistics for a limited panel of control measurements.
As a last resort, one can turn to large-scale analyses that examine the general reliability of datasets across many assay types~\cite{kramer_experimental_2012,kalliokoski_comparability_2013}, but this is to be avoided unless absolutely necessary.

When multiple independent measurements are not available, but knowledge of how a particular assay was conducted \emph{is} available, this knowledge can inform the construction of an assay-specific model incorporating some of the dominant contributions to error in a manner that can still be highly informative.
Using the \emph{bootstrap principle}---where we construct a simple computational replica of the real experiment and simulate virtual realizations of the experiment to understand the nature of the error in the experimental data---we often do a good job of accounting for dominant sources of error.
Using only the assay protocol and basic specifications of the imprecision and inaccuracy of various operations such as weighing and volume transfers, we show how to construct and simulate a simple assay model that incorporates these important (often dominant) sources of error. 
This approach, while simple, provides a powerful tool to understand how assay error depends on both the assay protocol and the imprecision and inaccuracy of basic operations, as well as the true value of the quantity being measured (such as compound affinity). 
This strategy is not limited to computational chemists and consumers of assay data---it can also be used to help optimize assay formats before an experiment is performed, help troubleshoot problematic assays after the fact, or ensure that all major sources of error are accounted for by checking that variation among control measurements match expectations.

We illustrate these concepts by considering a recent example from the literature: a report by Ekins et al.~\cite{ekins_dispensing_2013} on how the choice of dispensing technology impacts the apparent biological activity of the same set of compounds under otherwise identical conditions.
The datasets employed in the analyses~\cite{barlaam_novel_2009,barlaam_pyrimidine_2010} were originally generated by AstraZeneca using either a standard liquid handler with fixed (washable) tips or an acoustic droplet dispensing device to prepare compounds at a variety of concentrations in the assay, resulting in highly discrepant assay results (Figure~\ref{fig:overview}).
The assay probed the effectiveness of a set of pyrimidine compounds as anti-cancer therapeutics, targeting the EphB4 receptor, thought to be a promising target for several cancer types~\cite{xia_ephb4_2005,bardelle_inhibitors_2008}.
While the frustration for computational modelers was particularly great, since quantitative structure activity relationship (QSAR) models derived from these otherwise identical assays produce surprisingly divergent predictions, numerous practitioners from all corners of drug discovery expressed their frustration in ensuing blog posts and commentaries~\cite{lowe_drug_2015,evanko_serial_2013,ekins_what_2013}.
Hosts of potential explanations were speculated, including sticky compounds absorbed by tips ~\cite{palmgren_drug_2006} and compound aggregation ~\cite{feng_synergy_2006,feng_high-throughput_2005}.

%We make use of this real-world example to illustrate some of the basic concepts behind modeling the most common sources of error in assays.
For simplicity, we ask whether the simplest contributions to assay error---imprecision and bias in material transfer operations and imprecision in measurement---might account for some component of the discrepancy between assay techniques.
We make use of basic information---the assay protocol as described (with some additional inferences based on fundamental concepts such as compound solubility limits) and manufacturer specifications for imprecision and bias---to construct a model of each dispensing process in order to determine the overall inaccuracy and imprecision of the assay due to dispensing errors, and identify the steps that contribute the largest components to error.
To better illustrate these techniques, we also provide an annotated IPython notebook\footnote{The companion IPython notebook is available online at: \url{http://github.com/choderalab/dispensing-errors-manuscript}} that includes all of the computations described here in detail.
Interested readers are encouraged to download these notebooks and explore them to see how different assay configurations affect assay error, and customize the notebooks for their own scenarios.

\begin{figure*}[tb]
   \includegraphics[trim={0 15cm 0 8cm},clip,width=0.75\textwidth]{../figures/Fig1-4.pdf}
  \caption{{\bf Illustration of the stages of the two assay protocols considered here, utilizing either tip-based or acoustic droplet dispensing.}
  Two different assay protocols---utilizing different dispensing technologies---were used to perform the same assay~\cite{ekins_dispensing_2013,barlaam_novel_2009,barlaam_pyrimidine_2010}.
  In the case of tip-based dispensing, a Tecan Genesis liquid handler was used to create a serial dilution of test compounds using fixed washable tips, and a small quantity of each dilution was pipetted into the enzyme assay mixture prior to detection.
  In the case of acoustic dispensing (sometimes called acoustic droplet ejection), instead of creating a serial dilution, a Labcyte Echo was used to directly dispense nanoliter quantities of compound stock into the enzyme assay mixture prior to detection.
  The detection phase measured product accumulation after a fixed amount of time (here, detection of accumulated phosphorylated substrate peptide using AlphaScreen), and the resulting data were fit to obtain $p$IC$_{50}$ estimates.
  Ekins et al.~\citep{ekins_dispensing_2013} noted that the resulting $p$IC$_{50}$ data between tip-based dispensing and acoustic dispensing were highly discrepant, as shown in the central figure where the two sets of assay data are plotted against each other.
   }
  \label{fig:overview}
\end{figure*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Experimental error
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Experimental error}

Experimental error can be broken into two components: The \emph{imprecision} (quantified by standard deviation or variance), which characterizes the random component of the error that causes different replicates of the same assay to give slightly different results, and the \emph{inaccuracy} (quantified by bias), which is the deviation of the average over many replicates from the true value of the quantity being measured.

There are a wide variety of sources that contribute to experimental error. 
Variation in the quantity of liquid delivered by a pipette, errors in the reported mass of a dry compound, or noise in the measured detection readout of a well will all contribute to the error of an assay measurement.
If the average (mean) of these is the true or desired quantity, then these variations all contribute to imprecision.
If not----such as when a calibration error leads to a systematic deviation in the volume delivered by a pipette, the mass measured by a balance, or the average signal measured by a plate reader---the transfers or measurements will also contribute to inaccuracy or bias.
We elaborate on these concepts and how to quantify them below.

\section*{Modeling experimental error}

\subsubsection{The hard way: Propagation of error}

There are many approaches to the modeling of error and its propagation into derived data.
Often, undergraduate laboratory courses provide an introduction to the tracking of measurement imprecision, demonstrating how to propagate imprecision in individual measurements into derived quantities using Taylor series expansions---commonly referred to simply as \emph{propagation of error}~\cite{taylor_introduction_1997}.
For example, for a function $f(x,y)$ of two measured quantities $x$ and $y$ with associated standard errors $\sigma_x$ and $\sigma_y$ (which represent our estimate of the standard deviation of repeated measurements of $x$ and $y$), the first-order Taylor series error propagation rule is,
\begin{eqnarray}
\delta^2 f &=& \left[\frac{\partial f}{\partial x}\right]^2_x \, \sigma^2_x + \left[\frac{\partial f}{\partial y}\right]^2_y \sigma^2_y + \left[\frac{\partial f}{\partial x}\right]_x \left[\frac{\partial f}{\partial y}\right]_y \, \sigma^2_{xy} \nonumber \\ \label{equation:error-propagation}
\end{eqnarray}
where the correlated error $\sigma^2_{xy} = 0$ if the measurements of $x$ and $y$ are independent.
The expression for $\delta^2 f$, the estimated variance in the computed function $f$ over experimental replicates, in principle contains higher-order terms as well, but first-order Taylor series error propagation presumes these higher-order terms are negligible and all error can be modeled well as a Gaussian (normal) distribution.

For addition or subtraction of two independent quantities, this rule gives a simple, well-known expression for the additivity of errors in quadrature,
\begin{eqnarray}
f &=& x \pm y \nonumber \\
\delta^2 f &=& \sigma^2_x + \sigma^2_y 
\end{eqnarray}
For more complex functions of the data, however, even the simple form of Eq.~\ref{equation:error-propagation} for just two variables can be a struggle for most scientists to apply, since it involves more complex derivatives that may not easily simplify.

\subsubsection{The easy way: The bootstrap principle}

Instead, we adopt a simpler approach based on the \emph{bootstrap principle}~\cite{shalizi_simple_????}.
\emph{Bootstrapping} allows the sampling distribution to be approximated by simulating from a good estimate (or simulacrum) of the real process.
While many computational chemists may be familiar with \emph{resampling bootstrapping} for a large dataset, where resampling values from the dataset with replacement provides a way to simulate a replica of the real process, it is also possible to simulate the process in other ways, such as from a parametric or other model of the process.
Here, we model sources of random error using simple statistical distributions, and \emph{simulate} multiple replicates of the experiment, examining the distribution of experimental outcomes in order to quantify error.
Unlike propagation of error based on Taylor series approximations (Eq.~\ref{equation:error-propagation}), which can become nightmarishly complex for even simple models, quantifying the error by bootstrap simulation is straightforward even for complex assays.
While there are theoretical considerations, practical application of the bootstrap doesn't even require that the function $f$ be differentiable or easily written in closed form---as long as we can compute the function $f$ on a dataset, we can bootstrap it.

For example, for the case of quantities $x$ and $y$ and associated errors $\sigma_x$ and $\sigma_y$, we would conduct many realizations $n = 1, \ldots, N$ of an experiment in which we draw \emph{bootstrap replicates} $x_n$ and $y_n$ from normal (Gaussian) distributions
\begin{eqnarray}
x_n &\sim& \mathcal{N}(x, \sigma^2_x) \nonumber \\
y_n &\sim& \mathcal{N}(y, \sigma^2_y) \nonumber \\
f_n &\equiv& f(x_n, y_n)
\end{eqnarray}
where the notation $x \sim \mathcal{N}(\mu, \sigma^2)$ denotes that we draw the variable $x$ from a normal (Gaussian) distribution with mean $\mu$ and variance $\sigma^2$,
\begin{eqnarray}
x \sim \mathcal{N}(\mu, \sigma^2) &\Leftrightarrow& p(x) = \frac{1}{\sqrt{2 \pi} \sigma} \exp\left[-\frac{(x-\mu)^2}{2 \sigma^2}\right]
\end{eqnarray}
We then analyze the statistics of the $\{f_n\}$ samples as if we had actually run the experiment many times.
For example, we can quantify the statistical uncertainty $\delta f$ using the standard deviation over the bootstrap simulation realizations, $\mathrm{std}(f_n)$.
Alternatively, presuming we have simulated enough bootstrap replicates, we can estimate 68\% or 95\% confidence intervals, which may sometimes be very lopsided if the function $f$ is highly nonlinear.

Since most instruments we deal with in a laboratory---such as pipettes or liquid handlers or balances---have readily available manufacturer-provided specifications for imprecision and accuracy, we will generally make use of the normal (Gaussian) distribution\footnote{Volumes, masses, and concentrations must all be positive, so it is more appropriate in principle to use a \emph{lognormal} distribution to model these processes to prevent negative values.  In practice, however, if the relative imprecision is relatively small and negative numbers do not cause large problems for the functions, a normal distribution is sufficient.} in modeling the error $\Delta x$,
\begin{eqnarray}
\Delta x \sim \mathcal{N}(\mu, \sigma^2) \label{equation:Gaussian} ,
\end{eqnarray}
where $\Delta x \equiv x - x_*$ is the deviation from the true or desired value $x_*$, the mean $\mu$ represents the inaccuracy, and the standard deviation $\sigma$ represents the imprecision.

We will generally quantify the error from our bootstrap simulation replicates in terms of two primary statistics:

\noindent {\bf Relative bias (RB).}
As a measure of inaccuracy, we will compute the relative expected deviation from the true value $f$,
\begin{eqnarray}
\mathrm{RB} &\equiv& \frac{E[ f_n - f ]}{f} \label{equation:relative-bias} .
\end{eqnarray}
This is often expressed as a percentage (RB\%) by multiplying RB by 100.
Note that, for cases where $f = 0$, this can be a problematic measure, in which case the absolute bias (just the numerator) is a better choice.

\noindent {\bf Coefficient of variation (CV).}
As a measure of imprecision, we will compute the relative standard deviation,
\begin{eqnarray}
\mathrm{CV} &\equiv& \frac{\mathrm{std}(f_n)}{E[f_n]} \label{equation:relative-standard-deviation} ,
\end{eqnarray}
which can again be estimated from the mean over many bootstrap replicates, and is often also represented as a percent (CV\%) by multiplying CV by 100.

%Here, we take the approach that it is as simple as adding known values for imprecision and inaccuracy in pipetting into a model of your assay, and using parametric bootstrapping [ref] to sample through many replicates and getting a resulting expected bias and coefficient of variation (CV), which correspond to the imprecision and inaccuracy, respectively. 

% JDC: I reorganized the material a bit, but feel free to work some of this text into the above if I left out anything important!
%\subsection*{Error propagation}
%
%Error propagation, for example when we have many pipetting steps in a row each with its own error, can be a bit trickier to implement. 
%While there are a variety of ways of doing this, derivable from the Taylor Expansion, using parametric bootstrapping [ref] to sample through many replicates, as mentioned above, avoids having to implement these more complex forms of error propagation.
%Bootstrapping allows you to approximate the sampling distribution by simulating from a good estimate of the real process.
%The more common form of boostrapping is resampling bootstrapping, where the 'good estimate of the real process' resamples estimates from the observed sample.
%Here, parametric bootstrapping is used, where the 'good estimate of the real process' is a simulation of a model.
%This works well for a variety of models, and here we show it for a specific rather simple case, but it can be expanded to include much more complicated error models, without making the math of the error propagation any more complicated.
%In this case knowing the sampling distribution lets us quantify uncertainty

\subsection*{Simple liquid handling: Mixing solutions}

\subsubsection*{The bootstrap principle}

Consider the simplest kind of liquid transfer operation, in which we use some sort of pipetting instrument (handheld or automated) to combine two solutions.
For simplicity, we presume we combine a volume $v_\mathrm{stock}$ of compound stock solution of known true concentration $c_0$ with a quantity of buffer of volume $v_\mathrm{buffer}$.

Initially, we presume that these operations are free of bias, but have associated imprecisions $\sigma_\mathrm{stock}$ and $\sigma_\mathrm{buffer}$. 
To simulate this process using the bootstrap principle, we simulate a number of realizations $n = 1, \ldots, N$, where we again assume a normal distribution for the sources of error, neglecting bias and accounting only for imprecision,
\begin{eqnarray}
v_\mathrm{stock}^{(n)} &\sim& \mathcal{N}(v_\mathrm{stock}, \sigma_\mathrm{stock}^2) \nonumber \\
v_\mathrm{buffer}^{(n)} &\sim& \mathcal{N}(v_\mathrm{buffer}, \sigma_\mathrm{buffer}^2) \nonumber \\
v_\mathrm{tot}^{(n)} &=& v_\mathrm{stock}^{(n)} + v_\mathrm{buffer}^{(n)} \nonumber \\
c^{(n)} &=& c_0 / v_\mathrm{tot}^{(n)} .
\end{eqnarray}
We can then compute statistics over the bootstrap replicates of the resulting solution concentrations, $\{c^{(n)}\}$, $n = 1,\ldots,N$ to estimate the bias and variance in the concentration in the prepared solution.

\subsubsection*{Relative imprecision}

Manufacturer specifications\footnote{While manufacturer-provided specifications for imprecision and inaccuracy are often presented as the maximum-allowable values, we find these are a reasonable starting point for this kind of modeling.} often provide the imprecision in relative terms as a coefficient of variation (CV), from which we can compute the imprecision $\sigma$ in terms of transfer volume $v$ via $\sigma = \mathrm{CV} \cdot v$,
\begin{eqnarray}
\sigma_\mathrm{stock} &=& v_\mathrm{stock} \cdot \mathrm{CV} \nonumber \\
\sigma_\mathrm{buffer} &=& v_\mathrm{buffer} \cdot \mathrm{CV} \nonumber \\
v_\mathrm{stock}^{(n)} &\sim& \mathcal{N}(v_\mathrm{stock} , \sigma_\mathrm{stock}^2) \nonumber \\
v_\mathrm{buffer}^{(n)} &\sim& \mathcal{N}(v_\mathrm{buffer}, \sigma_\mathrm{buffer}^2) \nonumber \\
v_\mathrm{tot}^{(n)} &=& v_\mathrm{stock}^{(n)} + v_\mathrm{buffer}^{(n)} \nonumber \\
c^{(n)} &=& c_0 / v_\mathrm{tot}^{(n)} .
\end{eqnarray}
We remind the reader that a CV specified as a \% (CV\% or \%CV) should be divided by 100 to obtain the CV we use here.

\subsubsection*{Relative inaccuracy}

Similarly, the expected inaccuracy might also be stated in terms of a relative percentage of the volume being transferred.
The inaccuracy behaves differently from the imprecision in that the inaccuracy will \emph{bias} the transferred volumes in a consistent way throughout the whole experiment.
To model bias, we draw a single random bias for the instrument from a normal distribution, and assume all subsequent operations with this instrument are biased in the same relative way.
We presume the relative bias (RB)---expressed as a fraction, rather than a percent---is given as RB, and draw a specific instrumental bias $b^{(n)}$ for each bootstrap replicate of the experiment, simulating the effect of many replications of the experiment where the instrument is randomly recalibrated,
\begin{eqnarray}
b^{(n)} &\sim& \mathcal{N}(0, \mathrm{RB}^2) \nonumber \\
\sigma_\mathrm{stock} &=& v_\mathrm{stock} \cdot \mathrm{CV} \nonumber \\
\sigma_\mathrm{buffer} &=& v_\mathrm{buffer} \cdot \mathrm{CV} \nonumber \\
v_\mathrm{stock}^{(n)} &\sim& \mathcal{N}(v_\mathrm{stock} (1 + b^{(n)}) , \sigma_\mathrm{stock}^2) \nonumber \\
v_\mathrm{buffer}^{(n)} &\sim& \mathcal{N}(v_\mathrm{buffer} (1 + b^{(n)}), \sigma_\mathrm{buffer}^2) \nonumber \\
v_\mathrm{tot}^{(n)} &=& v_\mathrm{stock}^{(n)} + v_\mathrm{buffer}^{(n)} \nonumber \\
c^{(n)} &=& c_0 / v_\mathrm{tot}^{(n)} \:\: . \label{equation:relative-inaccuracy-mixing}
\end{eqnarray}
Obviously, if the instrument is never recalibrated, the bias will be the \emph{same} over many realizations of the experiment, but we presume that a calibration process is repeated frequently enough that its effect can be incorporated as a random effect over many replicates of the assay over a long timespan.

\subsubsection*{Uncertainty in initial concentration}

We could further extend this model to include uncertainty $\sigma_c$ in the stock concentration $c_0$ (where the concentration may be stated $c_0 \pm \sigma_c$), and begin to see how powerful and modular the bootstrap scheme is.
In this new model, each simulation realization $n$ includes one additional initial step,
\begin{eqnarray}
c_0^{(n)} &\sim& \mathcal{N}(c_0, \sigma_c^2) \nonumber \label{equation:stock-concentration-uncertainty-simple} \\
b^{(n)} &\sim& \mathcal{N}(0, \mathrm{RB}^2) \nonumber \\
\sigma_\mathrm{stock} &=& v_\mathrm{stock} \cdot \mathrm{CV} \nonumber \\
\sigma_\mathrm{buffer} &=& v_\mathrm{buffer} \cdot \mathrm{CV} \nonumber \\
v_\mathrm{stock}^{(n)} &\sim& \mathcal{N}(v_\mathrm{stock} (1 + b^{(n)}) , \sigma_\mathrm{stock}^2) \nonumber \\
v_\mathrm{buffer}^{(n)} &\sim& \mathcal{N}(v_\mathrm{buffer} (1 + b^{(n)}), \sigma_\mathrm{buffer}^2) \nonumber \\
v_\mathrm{tot}^{(n)} &=& v_\mathrm{stock}^{(n)} + v_\mathrm{buffer}^{(n)} \nonumber \\
c^{(n)} &=& c_0^{(n)} / v_\mathrm{tot}^{(n)} \:\: .
\end{eqnarray}
All we had to do was add one additional step to our bootstrap simulation scheme (Eq.~\ref{equation:relative-inaccuracy-mixing}) in which the stock concentration $c_0^{(n)}$ is independently drawn from a normal distribution with each bootstrap realization $n$.
The model can be expanded indefinitely with additional independent measurements or random variables in the same simple way.

Below, we exploit the modularity of bootstrap simulations to design a simple scheme to model a real assay---the measurement of $p$IC$_{50}$s for compounds targeting the EphB4 receptor~\cite{ekins_dispensing_2013,barlaam_novel_2009,barlaam_pyrimidine_2010}---without being overwhelmed by complexity.
This assay is particularly interesting because data exists for the same assay performed using two \emph{different} dispensing protocols that led to highly discrepant assay $p$IC$_{50}$ data, allowing us to examine how different sources of error arising from different dispensing technologies can impact an otherwise identical assay.
We consider only errors that arise from the transfer and mixing of volumes of solutions with different concentrations of compound, using the same basic strategy seen here to model the mixing of two solutions applied to the complex liquid handling operations in the assay.
To more clearly illustrate the impact of imprecision and inaccuracy of dispensing technologies, we neglect considerations of the completeness of mixing, which can itself be a large source of error in certain assays\footnote{A surprising amount of effort is required to ensure thorough mixing of two solutions, especially in the preparation of dilution series~\cite{walling_mixing_2007,weiss_modeling_2002,mitre_turbo-mixing_2007}. We have chosen not to explicitly include this effect in our model, but it could similarly be added within this framework given some elementary data quantifying the bias induced by incomplete mixing.}.

\subsection*{Modeling an enzymatic reaction and detection of product accumulation}

The EphB4 assay we consider here~\cite{ekins_dispensing_2013,barlaam_novel_2009,barlaam_pyrimidine_2010}, illustrated schematically in Figure~\ref{fig:overview}, measures the rate of substrate phosphorylation in the presence of different inhibitor concentrations.
After mixing the enzyme with substrate and inhibitor, the reaction is allowed to progress for one hour before being quenched by the addition of a quench buffer containing EDTA.
The assay readout (in this case, AlphaScreen) measures the accumulation of phosphorylated substrate peptide.
Fitting a binding model to the assay readout over the range of assayed inhibitor concentrations yields an observed $p$IC$_{50}$.

A simple model of inhibitor binding and product accumulation for this competition assay can be created using standard models for competitive inhibition of a substrate $S$ with an inhibitor $I$. 
Here, we assume that in excess of substrate, the total accumulation of product in a fixed assay time will be proportional to the relative enzyme turnover velocity times time, $V_0 t$, and use an equation derived assuming Michaelis-Menten kinetics,
\begin{eqnarray}
V_{0} t &=& \frac{V_\mathrm{max} [S] t}{K_{m}\left(1+[I]/K_{i}\right)+[S]} ,
\end{eqnarray}
where the Michaelis constant $K_{m}$ and substrate concentration $[S]$ for the EphB4 system are pulled directly from the assay methodology description~\cite{barlaam_novel_2009,barlaam_pyrimidine_2010}.
To simplify our modeling, we divide by the constants $V_\mathrm{max} t$, and work with the simpler ratio,
\begin{eqnarray}
\frac{V_{0}}{V_\mathrm{max}} &=& \frac{[S]}{K_{m}\left(1+[I]/K_{i}\right)+[S]} \label{equation:competitive-inhibition} ,
\end{eqnarray}
In interrogating our model, we will vary the true inhibitor affinity $K_{i}$ to determine how the assay imprecision and inaccuracy depend on true inhibitor affinity.
%For a given $K_i$ and $V_\mathrm{max}$, the relative activity, $V_{0}/V_{max}$, will primarily depend true inhibitor concentration $[I]$ in the assay well
%As we shall see, we use the same bootstrap scheme to model this true inhibitor concentrations in the assay wells and how they relate to the concentrations that were \emph{intended} from an error-free execution of the protocol.

In reality, detection of accumulated product will also introduce uncertainty.
First, there is a minimal detectable signal below which the signal cannot be accurately quantified---below this threshold, a random background signal or ``noise floor'' is observed.
Second, any measurement will be contaminated with noise, though changes to the measurement protocol---such as collecting more illumination data at the expense of longer measurement times---can affect this noise.
While simple calibration experiments can often furnish all of the necessary parameters for a useful detection error model---such as measuring the background signal and signal relative to a standard for which manufacturer specifications are available---we omit these effects to focus on the potential for the discrepancy between liquid handling technologies to explain the difference in assay results.

\subsection*{Advanced liquid handling: Making a dilution series}

Because the affinities and activities of compounds can vary across a dynamic range that spans several orders of magnitude, it is common for assays to use a dilution series to measure the activity and potency of ligands. 
To create a dilution series, an initial compound stock is diluted into buffer in the first well of the series, and the contents mixed; for each subsequent well, a volume from the previous well is transferred into a well containing only buffer, and mixed (Figure~\ref{fig:dilution}).
Commonly, each subsequent dilution step uses fixed ratios, such as 1:2 or 1:10 of solute solution to total volume\footnote{Note that a 1:2 dilution refers to combining one part solute solution with one part diluent.}.

It is easy to see how the creation of a dilution series by pipetting can amplify errors:
because each dilution step involves multiple pipetting operations, and the previous dilution in the series is used to prepare the next dilution, errors will generally grow with each step.
As a result, the liquid handling instrumentation can have a substantial impact on the results obtained.
Here, we compare an aqueous dilution series made with a liquid handler that makes use of fixed, washable tips (a Tecan Genesis) with an assay prepared directly via direct-dispensing using an acoustic dispensing instrument (a Labcyte Echo).

\subsubsection*{Tip-based liquid handling}

To create a serial dilution series (Figure~\ref{fig:dilution}), we first transfer an aliquot of compound in DMSO stock solution to the first well, mixing it with buffer, to prepare the desired initial concentration $c_0$ at volume $v_\mathrm{intermediate}$ for the dilution series.
Next, we sequentially dilute a volume $v_\mathrm{transfer}$ of this solution with a volume $v_\mathrm{buffer}$ of buffer, repeating this process to create a total of $n_\mathrm{dilutions}$ solutions. 
To model the impact of imprecision and inaccuracy on the serial dilution process, we again use manufacturer-provided specifications for the Tecan Genesis: the relative imprecision is stated to be 3\% and the inaccuracy as 3-5\% for the volumes in question~\cite{_tecan_2001}. 
The resulting concentration $c_m$ of each dilution $m$ is determined by both the previous concentration $c_{m-1}$  and by the pipetted volumes $v_\mathrm{transfer}$ and $v_\mathrm{buffer}$, each of which is randomly drawn from a normal distribution.
Putting this together in the same manner as for the simple mixing of solutions, we have
\begin{eqnarray}
%c_0^{(n)} &\sim& \mathcal{N}(c_0, \sigma_c^2) \nonumber  \\
b^{(n)} &\sim& \mathcal{N}(0, \mathrm{RB}^2) \nonumber \\
\sigma_\mathrm{transfer} &=& v_\mathrm{transfer} \cdot \mathrm{CV} \nonumber \\
\sigma_\mathrm{buffer} &=& v_\mathrm{buffer} \cdot \mathrm{CV} \nonumber \\
v_{\mathrm{transfer},m}^{(n)} &\sim& \mathcal{N}(v_\mathrm{transfer} (1 + b^{(n)}) , \sigma_\mathrm{transfer}^2) \nonumber \\
v_{\mathrm{buffer},m}^{(n)} &\sim& \mathcal{N}(v_\mathrm{buffer} (1 + b^{(n)}), \sigma_\mathrm{buffer}^2) \nonumber \\
v_{\mathrm{intermediate}, m}^{(n)} &=& v_{\mathrm{transfer}, m}^{(n)} + v_{\mathrm{buffer}, m}^{(n)}  \nonumber \\
v_{\mathrm{final}, (m-1)}^{(n)} &\sim& v_{\mathrm{intermediate}, (m-1)} - v_{\mathrm{transfer}, m} \nonumber \\
c_m^{(n)} &=& c_{m-1}^{(n)} / v_{\mathrm{intermediate}, m} \:\: , \label{equation:stock-concentration-uncertainty-simple}
\end{eqnarray}
where the last five steps are computed for dilution $m = 1, \ldots, (n_\mathrm{dilutions}-1)$.
In the companion notebook, we make comparisons easier by also removing a final volume $v_\mathrm{transfer}$ from the last well so all wells have the same intended final volume.

In the EphB4 protocol~\cite{barlaam_novel_2009,barlaam_pyrimidine_2010}, the initial dilution step from 10 mM DMSO stocks is not specified, so we choose initial concentration $c_0$ = 600 $\mu$M in order to match the maximum assay concentration used in the direct dispense version of the assay (described in the next section).
We presume an initial working volume of $v_\mathrm{intermediate}$ = 100 $\mu$L, and model this dispensing process using Eq.~\ref{equation:relative-inaccuracy-mixing}.
We presume this solution is then serially 1:2 diluted with 5\% DMSO for a total of $n_\mathrm{dilutions}$ = 8 dilutions\footnote{The published protocol~\cite{barlaam_novel_2009,barlaam_pyrimidine_2010} does not specify how many dilutions were used, so for illustrative purposes, we selected $n_\mathrm{dilutions} = 8$.} with $v_\mathrm{transfer} = v_\mathrm{buffer} = 50 \: \mu\mathrm{L}$, which after dilution into the assay plate will produce a range of assay concentrations from 800 nM to 100 $\mu$M\footnote{We note that real assays may encounter solubility issues with such high compound concentrations, and that the nonideal nature of water:DMSO solutions means that serial dilution of DMSO stocks will not always guarantee all dilutions will readily keep compound soluble.  Here, we also presume the DMSO and EDTA control wells are not used in fitting to obtain $p$IC$_{50}$ values.}.
We estimate the appropriate coefficient of variation (CV) and relative bias (RB) for the Tecan Genesis liquid handling instrument used in this assay using a linear interpolation over the range of volumes in a manufacturer-provided table~\cite{_tecan_2001}.
Sampling over many bootstrap replicates, we are then able to estimate the CV and RB in the resulting solution concentrations for the dilution series.
Figure~\ref{fig:volumes-n-concentrations} (left panel) shows the estimated CV and RB for the resulting concentrations in the dilution series.
While the CV for the volume is relatively constant since we are always combining only two transferred aliquots of liquid, the CV for both the concentration and the total quantity of compound per well grow monotonically with each subsequent dilution.
On the other hand, because the bias is assumed to be zero on average, the average dilution series bias over many bootstrap replicates with randomly calibrated instruments will be free of bias.
This situation may be different, of course, if the \emph{same} miscalibrated instrument is used repeatedly without frequent recalibration.

Once the dilution series has been prepared, the assay is performed in a 384-well plate, with each well containing 2 $\mu$L of the diluted compound in buffer combined with 10 $\mu$L of assay mix (which contains EphB4, substrate peptide, and cofactors) for a total assay volume of 12 $\mu$L.
This liquid transfer step is easily modeled using the steps for modeling the mixing of two solutions in Eq.~\ref{equation:relative-inaccuracy-mixing}.

\begin{figure*}[tb]
    %\includegraphics[width=\columnwidth]{../figures/dilution.pdf}
    \includegraphics[width=0.82\textwidth]{../figures/dilution.pdf}

  \caption{{\bf Preparation of a serial dilution series with a fixed-tip liquid handler.}
  To create a dilution series with a fixed-tip liquid handler, a protocol similar to the preparation of a dilution series by hand pipetting is followed.
  Starting with an initial concentration $c_0$ and initial volume $V_\mathrm{initial}$ in the first well, a volume $v_\mathrm{transfer}$ is transferred from each well into the next well, in which a volume of buffer, $v_\mathrm{buffer}$, has already been pipetted. 
  In the case of a 1:2 dilution series, $v_\mathrm{transfer}$ and $v_\mathrm{buffer}$ are equal, so the intended concentration in the second well will be $c_0/2$. 
  This transfer is repeated for all subsequent wells to create a total of $n_\mathrm{dilutions}$ dilutions. 
  For convenience, we assume that a volume $v_\mathrm{transfer}$ is removed from the last well so that all wells have the same final volume of $v_\mathrm{transfer} = v_\mathrm{buffer}$, and that the error in the initial concentration ($c_0$) is negligible.
  }
  \label{fig:dilution}
\end{figure*}

\subsubsection*{Direct dispensing technologies}

Using a direct dispensing technology such as acoustic droplet ejection (ADE), we can eliminate the need to prepare an intermediate dilution series, instead adding small quantities of the compound DMSO stock solution directly into the assay plate.
For the LabCyte Echo used in the EphB4 assay, the smallest volume dispensed is 2.5 nL droplets; other instruments such as the HP D300/D300e can dispense quantities as small as 11 pL using inkjet technology.
To construct a model for a direct dispensing process, we transfer a volume $v_\mathrm{dispense}$ of ligand stock in DMSO at concentration $c_0$ into each well already containing assay mix at volume $v_\mathrm{mix}$ (presumed to be pipetted by the Tecan Genesis), and backfill a volume $v_\mathrm{backfill}$ with DMSO to ensure each well has the same intended volume and DMSO concentration (Figure~\ref{fig:direct_dispense}). 
We again incorporate the effects of imprecision and bias using manufacturer-provided values;
for the Labcyte Echo, the relative imprecision (CV) is stated as 8\% and the relative inaccuracy (RB) as 10\% for the volumes in question~\cite{_echo_2011},
\begin{eqnarray}
b_\mathrm{Echo}^{(n)} &\sim& \mathcal{N}(0, \mathrm{RB}_\mathrm{Echo}^2) \nonumber \\
b_\mathrm{Genesis}^{(n)} &\sim& \mathcal{N}(0, \mathrm{RB}_\mathrm{Genesis}^2) \nonumber \\
\sigma_\mathrm{dispense} &=& v_\mathrm{dispense} \cdot \mathrm{CV}_\mathrm{Echo} \nonumber \\
\sigma_\mathrm{backfill} &=& v_\mathrm{backfill} \cdot \mathrm{CV}_\mathrm{Echo} \nonumber \\
\sigma_\mathrm{mix} &=& v_\mathrm{mix} \cdot \mathrm{CV}_\mathrm{Genesis} \nonumber \\
v_\mathrm{dispense}^{(n)} &\sim& \mathcal{N}(v_\mathrm{dispense} (1 + b_\mathrm{Echo}^{(n)}) , \sigma_\mathrm{dispense}^2) \nonumber \\
v_\mathrm{backfill}^{(n)} &\sim& \mathcal{N}(v_\mathrm{backfill} (1 + b_\mathrm{Echo}^{(n)}), \sigma_\mathrm{backfill}^2) \nonumber \\
v_\mathrm{mix}^{(n)} &\sim& \mathcal{N}(v_\mathrm{mix} (1 + b_\mathrm{Genesis}^{(n)}), \sigma_\mathrm{mix}^2) \nonumber \\
v_\mathrm{assay}^{(n)} &=& v_\mathrm{dispense}^{(n)} + v_\mathrm{backfill}^{(n)} + v_\mathrm{mix}^{(n)} \nonumber \\
c_m^{(n)} &=& c_\mathrm{stock} / v_\mathrm{assay}^{(n)} \:\: . \label{equation:stock-concentration-uncertainty-simple}
\end{eqnarray}
Since the maximum specified backfilled volume was 120 nL, we presume that $v_\mathrm{dispense}$ consisted of 8 dilutions ranging from 2.5 nL (the minimum volume the Echo can dispense) to 120 nL in a roughly logarithmic series. 
Note that this produces a much narrower dynamic range than the dilution series experiment, with the minimum assay intended concentration being 2.5 $\mu$M assuming a 10 mM DMSO stock solution concentration $c_\mathrm{stock}$.
We can then produce an estimate for the errors in volumes and concentrations (Figure~\ref{fig:volumes-n-concentrations}, middle panels) by generating many synthetic replicates of the experiment.
Because direct dispensing technologies can dispense directly into the assay plate, rather than creating an intermediate dilution series that is then transferred into the assay wells, direct dispensing experiments can utilize fewer steps (and hence fewer potential inaccuracy- and imprecision-amplifying steps) than the tip-based assays that are dependent on the creation of an intermediate dilution series.

\begin{figure}[tb]
    \includegraphics[width=\columnwidth]{../figures/direct_dispense.pdf}

  \caption{{\bf Preparation of a dilution series with direct-dispense technology.}
  With a direct-dispense liquid handler---such as the LabCyte Echo, which uses acoustic droplet ejection---instead of first preparing a set of compound solutions at different concentrations via serial dilution, the intended quantity of compound can be dispensed into the assay plates directly without the need for creating an intermediate serial dilution.
  We model this process by considering the process of dispensing into each well independently.
  A volume $v_\mathrm{dispense}$ of compound stock in DMSO at concentration $c_0$ is dispensed directly into an assay plate containing a volume $v_\mathrm{mix}$ of assay mix.
  To maintain a constant DMSO concentration throughout the assay---in this case of the EphB4 assay, 120 nL---a volume $v_\mathrm{backfill}$ of pure DMSO is also dispensed via acoustic ejection.
  }
  \label{fig:direct_dispense}
\end{figure}

\subsubsection*{Fixed tips and the dilution effect}

Simply including the computed contributions from inaccuracy and imprecision in our model of the  Ekins~et al.~dataset~\cite{ekins_dispensing_2013}, it is easy to see that the imprecision is not nearly large enough to explain the discrepancies between measurements made with the two dispensing technologies~(Figure~\ref{fig:IC50_bias}).
Multichannel liquid-handlers such as the Tecan Genesis that utilize liquid-displacement pipetting with fixed tips actually have a nonzero bias in liquid transfer operations due to a dilution effect. 
This effect was previously characterized in work from Bristol Myers Squibb (BMS)~\cite{dong_use_2006,gu_dilution_2007}, where it was found that residual system liquid---the liquid used to create the pressure differences required for pipetting---can cling to the interior of the tips after washing and mix with sample when it is being aspirated (Figure~\ref{fig:dilution_effect}). 
While the instrument can be calibrated to dispense volume without bias, the concentration of the dispensed solution can be measurably diluted.

To quantify this effect, the BMS team used both an Artel dye-based Multichannel Verification System (MVS) and gravimetric methods, concluding that this dilution effect contributes a -6.30\% inaccuracy for a target volume of 20 $\mu$L~\cite{dong_use_2006}.
We can expand our bootstrap model of dilution with fixed tips (Eq.~\ref{equation:stock-concentration-uncertainty-simple}) to include this effect with a simple modification to the concentration of dilution solution $m$,
\begin{eqnarray}
c_m^{(n)} &=& (1 + d) \, c_{m-1}^{(n)} / v_{\mathrm{intermediate},m}^{(n)}
\end{eqnarray}
where the factor $d = -0.0630$ accounts for the -6.30\% dilution effect.
The resulting CV and RB in volumes, concentrations, and quantities (Figure~\ref{fig:volumes-n-concentrations}, middle) indicate a significant accumulation of bias.
This is especially striking when considered alongside the corresponding values for disposable tips (Figure~\ref{fig:volumes-n-concentrations}, left)---which lack the dilution effect---and the acoustic-dispensing model (Figure~\ref{fig:volumes-n-concentrations}, right), both of which are essentially free of bias when the average over many random instrument recalibrations is considered.

This dilution effect also must be incorporated into the transfer of the diluted compound solutions (2 $\mu$L) into the enzyme assay mix (10 $\mu$L) to prepare the final 12 $\mu$L assay volume, further adding to the overall bias of the assay results from the fixed-tips instrument. 

\begin{figure}[tb]
   % \includegraphics[width=0.325\textwidth]{../figures/dilution_effect.pdf}
    \includegraphics[width=\columnwidth]{../figures/dilution_effect.pdf}

  \caption{{\bf Fixed tips dilute aspirated samples with system liquid.}
  Automated liquid handlers with fixed tips utilizing liquid-displacement pipetting technology (such as the Tecan Genesis used in the EphB4 assay described here) use a washing cycle in which system liquid (generally water or buffer) purges samples from the tips in between liquid transfer steps.
  Aspirated sample (blue) can be diluted by the system liquid (light purple) when some residual system liquid remains wetting the inside walls of the tip after purging.
  This residual system liquid is mixed with the sample as it is aspirated, creating a mixture of system liquid and sample (red) that dilutes the sample that is dispensed. 
  While the use of an air gap (white) reduces the magnitude of this dilution effect, dilution is a known issue in fixed tip liquid-based automated liquid handling technologies, requiring more complex liquid-handling strategies to eliminate it~\cite{gu_dilution_2007}. 
  Diagram adapted from Ref.~\cite{gu_dilution_2007}. 
  }
  \label{fig:dilution_effect}
\end{figure}


\begin{figure*}[tb]
    \includegraphics[width=1.0\textwidth]{../figures/volumes-n-concentrations.pdf}

  \caption{{\bf Modeled accumulation of random and systematic error in creating dilution series with fixed tips and acoustic dispensing.}
  The model predicts how errors in compound concentration, well volume, and compound quantity accumulate for a dilution series prepared using fixed tips neglecting dilution effects (\emph{left}) or including dilution effects (\emph{middle}) compared with an acoustic direct-dispensing process (\emph{right}).
  Imprecision and inaccuracy parameters appropriate for a Tecan Genesis (fixed tips dispensing) or Labcyte Echo (acoustic dispensing) were used, and assume that the initial compound stocks had negligible concentration error; see text for more details.
  The top panels show the average relative random error via the coefficient of variation (CV) of concentration, volume, or quantity, while the bottom panels depict the relative bias (RB); both quantities are expressed as a percentage.
  For tip-based dispensing, relative random concentration error (CV) accumulates with dilution number, while for acoustic dispensing, this is constant over all dilutions.
  When the dilution effect is included for fixed tips, there is significant bias accumulation over the dilution series.
  Note that the CV and RB shown for acoustic dispensing are for the final assay solutions, since no intermediate dilution series is created.
  }
  \label{fig:volumes-n-concentrations}
\end{figure*}

\begin{figure*}[tb]
\includegraphics[width=1.0\textwidth]{../figures/acoustic-vs-tips.pdf}
  
  \caption{{\bf Comparing modeled errors in measured $p$IC$_{50}$ values using tip-based or acoustic direct dispensing.}
  \emph{Top row:} Bootstrap simulation of the entire assay yields a distribution of $V_0/V_\mathrm{max}$ (proportional to measured product accumulation) vs ideal inhibitor concentration $[I]$ curves for many synthetic bootstrap replicates of the assay.  
  Here, the inhibitor is modeled to have a true $K_i$ of 1 nM (p$K_i = -9$).
  \emph{Middle row:} For the same inhibitor, we obtain a distribution of measured $p$IC$_{50}$ values from fitting the Using our model we can look at the variance in activity measurements as a function of inhibitor concentration $[I]$ (top), which then directly translates into a distribution of measured $p$IC$_{50}$ values.
  \emph{Bottom row:} Scaning across a range of true compound affinities, we can repeat the bootstrap sampling procedure and analyze the distribution of measured $p$IC$_{50}$ values to obtain estimates of the relative bias (red) and CV (black) for the resulting measured $p$IC$_{50}$s.
  For all methods, the CV increases for weaker affinities; for tip-based dispensing using fixed tips and incorporating the dilution effect, a significant bias is notable.
  }
  \label{fig:acoustic-vs-tips}
\end{figure*}

\subsection*{Fitting the assay readout to obtain $p$IC$_{50}$ data}

While the IC$_{50}$ reported in the EphB4 assay~\cite{ekins_dispensing_2013,barlaam_novel_2009,barlaam_pyrimidine_2010} in principle represents the stated concentration of compound required to inhibit enzyme activity by half, this value is estimated in practice by numerically fitting a model of inhibition to the measured assay readout across the whole range of concentrations measured using a method such as least-squared (the topic of another article in this series~\cite{jones_fitting_2015}).

To mimic the approach used in fitting the assay data, we use a nonlinear least-squares approach (based on the simple {\tt curve\_fit} function from {\tt scipy.optimize}) to fit $V_0 / V_\mathrm{max}$ computed from the competitive inhibition model (Eq.~\ref{equation:competitive-inhibition}, shown in Fig.~\ref{fig:acoustic-vs-tips}, top panels) using the true assay well concentrations to obtain a $K_i$ and then compute the IC$_{50}$ from this fit value.
We can then use a simple relation between IC$_{50}$ and $K_{i}$ to compute the reported assay readout,
\begin{eqnarray}
\mathrm{IC}_{50} &=& K_{i}\left(1+\frac{[S]}{K_{m}}\right) \label{equation:IC50} .
\end{eqnarray} 
The reported results are not IC$_{50}$ values but $p$IC$_{50}$ values, 
\begin{eqnarray}
p\mathrm{IC}_{50} &=& \log_{10} \mathrm{IC}_{50} \label{equation:pIC50} .
\end{eqnarray}
Note that no complicated manipulation of these equations is required.
As can be seen in the companion IPython notebook, we can simply use the {\tt curve\_fit} function to obtain a $K_i$ for each bootstrap replicate, and then store the $p$IC$_{50}$ obtained from the use of Eqs.~\ref{equation:IC50} and \ref{equation:pIC50} above (Fig.~\ref{fig:acoustic-vs-tips}, middle panels).
Repeating this process for a variety of true compound affinities allows the imprecision (CV) and bias (RB) to be quantified as a function of true compound affinity (Fig.~\ref{fig:acoustic-vs-tips}, bottom panels).

\begin{figure}[tb]
   % \includegraphics[trim={0 4cm 0 4cm},clip,width=0.5\textwidth]{../figures/compare-pIC50-bias_corrected.pdf}
    \includegraphics[width=\columnwidth]{../figures/compare-pIC50-bias_corrected.pdf}

  \caption{{\bf Adding bias shifts $p$IC$_{50}$ values closer to equivalence.}
  The original experimental pIC50 values obtained using from fixed tips (red) are plotted against $p$IC$_{50}$ values from acoustic dispensing, with errors bars representing the uncertainty (shown as 95\% confidence intervals) estimated by bootstrapping from our models. 
  Incorporating the dilution effect from tip-based dispensing (green) shifts the experimental $p$IC$_{50}$ values closer to concordance between tip-based and acoustic-based measurements. 
  While this does not entirely explain all discrepancies between the two sets of data, it shifts the root mean square error between the tip-based and acoustic-based dispensing methods from 1.56 to 1.40 pIC50 units.
  The model also demonstrates that (1) the bias induced by the fixed tips explains much of the $p$IC$_{50}$ shift between the two datasets, and (2) there is still a large degree of variation among the measurements not accounted for by simple imprecision in liquid transfers.
  This demonstrates the power of building simple error models to improve our understanding of experimental data sets.
  }
  \label{fig:IC50_bias}
\end{figure}


\begin{figure}[tb]
   % \includegraphics[trim={0 4cm 0 4cm},clip,width=0.5\textwidth]{../figures/compare-pIC50-bias_corrected.pdf}
    \includegraphics[width=\columnwidth]{../figures/dilute-bias-pIC50-8-16-32.pdf}

  \caption{{\bf Bias in measured $p$IC$_{50}$ depends on number of wells in dilution series when using fixed washable tips.}
  If the dilution series is extended beyond 8 wells to instead span 16 or 32 wells, the bias effect in the measured $p$IC$_{50}$ increases as the cumulative effect of the dilution effect illustrated in Fig.~\ref{fig:dilution_effect} shifts the apparent affinity of the compound.
  Because the dilution bias is greater for lower compound concentrations, this effect is more drastic for compounds with high affinity.
  }
  \label{fig:bias_vs_nwells}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DISCUSSION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Discussion}

\subsection*{Use of fixed washable tips can cause significant accumulation of bias due to dilution effects}

The most striking feature of Fig.~\ref{fig:volumes-n-concentrations} is the significant accumulation of bias in the preparation of a dilution series using fixed washable tips (Fig.~\ref{fig:volumes-n-concentrations}, bottom middle panel).
Even for an 8-point dilution series, the relative bias (RB) is almost -50\% in the final well of the dilution series.
As a result, the measured $p$IC$_{50}$ values also contain significant bias toward weaker affinities (Fig.~\ref{fig:acoustic-vs-tips}, bottom middle panel) by about 0.25 log$_{10}$ units for a large range of compound affinities.
At weaker compound affinities, this effect is diminished by virtue of the fact that the first few wells of the dilution series have a much smaller RB (Fig.~\ref{fig:volumes-n-concentrations}, bottom middle panel).

This cumulative dilution effect becomes more drastic if the dilution series is extended beyond 8 points.
If instead a dilution series is created across 16 or 32 wells and assayed, the RB in the final well of the dilution series can reach nearly -100\% (see accompanying IPython notebook for 32-well dilution series).
As a result, the bias in the measured $p$IC$_{50}$ as a function of true $pK_i$ also grows significantly for these larger dilution series (Fig.~\ref{fig:bias_vs_nwells}).

\subsection*{Imprecision is greater for direct dispensing with the Echo}

As evident from the top panels of Fig.~\ref{fig:volumes-n-concentrations}, the CV for concentrations in the assay volume for direct acoustic dispensing (right) is significantly higher than the CV of the dilution series prepared with tips (left and middle).
This effect manifests itself in the CV of measured $p$IC$_{50}$ values as a higher imprecision (Fig.~\ref{fig:acoustic-vs-tips}, bottom panels), where the CV for acoustic dispensing is nearly twice that of tip-based dispensing.
Despite the increased CV, there are still numerous advantages to the use of direct dispensing technology: 
Here, we have ignored a number of difficulties in the creation of a dilution series beyond this dilution effect, including the difficulty of attaining good mixing~\cite{walling_mixing_2007,weiss_modeling_2002,mitre_turbo-mixing_2007}, the time required to prepare the serial dilution series (during which evaporation may be problematic), and a host of other issues.

\subsection*{Imprecision is insufficient to explain the discrepancy between assay technologies}

Fig.~\ref{fig:IC50_bias} depicts the reported assay results~\cite{ekins_dispensing_2013,barlaam_novel_2009,barlaam_pyrimidine_2010} augmented with error bars and corrected for bias using models appropriate for disposable tips (blue circles) or fixed washable tips (green circles) that include the dilution effect described in Fig.~\ref{fig:dilution_effect}.
Perfect concordance of measured $p$IC$_{50}$s between assay technologies would mean all points fall on the black diagonal line.
We can see that simply adding the imprecision in a model with fixed tips (Fig.~\ref{fig:dilution_effect}, blue circles, horizontal and vertical bars denote 95\% confidence intervals) is insufficient to explain the departure of the dataset from this diagonal concordance line.

When the tip dilution effect for washable tips is incorporated (Fig.~\ref{fig:dilution_effect}, green circles), there is a substantial shift toward higher concordance.
If, instead of an 8-point dilution series, a 16- or 32-point dilution series was used, this shift toward concordance is even larger (Fig.~\ref{fig:bias_vs_nwells}).
While this effect may explain of a substantial component of the divergence between assay technologies, there is no doubt a significant discrepancy remains.

\subsection*{Other contributions to the discrepancy are likely relevant}

Serial dilutions are commonly used in the process of determining biologically and clinically relevant values such as inhibition concentrations (IC$_{ 50}$)  and dissociation constants (K$_{d}$). 
While high-throughput automation methods can improve the reproducibility of these measurements over manual pipetting, even robotic liquid handlers are victim to the accumulation of both random and systematic error.
Since the AstraZeneca dataset~\cite{barlaam_novel_2009,barlaam_pyrimidine_2010} and the related analysis by Ekins et al.~\cite{ekins_dispensing_2013}, several studies have posited that acoustic dispensing results in fewer false positives and negatives than tip-based dispensing and that this phenomenon is not isolated to EphB4 receptor inhibitors~\cite{wingfield_impact_2012,olechno_direct_2013,olechno_sound_2013,olechno_improving_2006}. 
%Here, we have shed some light on why this might be with some simple modeling, available for extended use through the accompanying IPython notebook.

\subsection*{The power of bootstrapping}

We have demonstrated how a simple model based on the bootstrap principle, in which nothing more than the manufacturer-provided imprecision and inaccuracy values and a description of the experimental protocol were used to \emph{simulate} virtual replicates of the experiment for a variety of simulated compound affinities allowed us to estimate the imprecision and inaccuracy of measured $p$IC$_{50}$s.
It also identified the difficulty in creating an accurate dilution series using washable fixed tips, with the corresponding dilution effect being a significant contribution to discrepancies in measurements between fixed pipette tips and direct dispensing technologies. 
In addition to providing some estimate for the random error in measured affinities, the computed bias can even be used to \emph{correct} for the bias introduced by this process after the fact, though it is always safer to take steps to minimize this bias before the assay is performed. 

The EphB4 assay considered here is just one example of a large class of assays involving dilution or direct dispensing of query compounds followed by detection of some readout.
The corresponding bootstrap model can be used as a template for other types of experiments relevant to computational modelers.

This approach can be a useful general tool for both experimental and computational chemists to understand common sources of error within assays that use dilution series and how to model and correct for them.
Instead of simply relying on intuition or historically successful protocol designs, experimentalists could use bootstrap simulation models during assay planning stages to verify that the proposed assay protocol is capable of appropriately discriminating among the properties of the molecules in question given the expected range of IC$_{ 50}$ or K$_{i}$ to be probed, once known errors are accounted for.
Since the model is quantitative, adjusting the parameters in the assay protocol could allow the experimentalist to optimize the protocol to make sure the data is appropriate to the question at hand. 
For example, in our own laboratory, it has informed the decision to use only direct dispensing technologies---in particular the HP D300~\cite{jones_alternative_2013}---for fluorescent ligand-binding assays that require preparation of a range of compound concentrations.

This modeling approach can also be extremely useful in determining appropriate tests and controls to use to be sure errors and biases are properly taken into account in general. 
If one is not certain about the primary sources of error in an experiment, one is arguably not certain about the results of the experiment in general. 
Understanding these errors, and being certain they are accounted for via clear benchmarks in experimental assays could help ensure the reproducibility of assays in the future, which is currently a topic of great interest. 
Especially with such a wide ranging set of assays that use dilution series, most notably toward the development of proteins and small molecules to study and treat disease, this is a very important category of experiments to understand how to make more clearly reproducible and interpretable.

While here we have illustrated the importance of modeling to the specific case of liquid handling with fixed tips in the context of measuring IC$_{50}$ values for EphB4 inhibitors, there are still large discrepancies that have not been explained, and perhaps variations on this model could explain everything, but perhaps the full explanation comes from parts of the assay yet to be incorporated into this model.
As experiments become more automated and analysis becomes more quantitative, understanding these errors will be increasingly important both for the consumers (computational modelers) and producers (experimentalists) of these data.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ACKNOWLEDGMENTS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Acknowledgments}
\label{section:acknowledgments}
The authors are grateful to Anthony Nichols (OpenEye) and Martin Stahl (Roche) for organizing the excellent 2013 Computer-Aided Drug Discovery Gordon Research Conference on the topic of ``The Statistics of Drug Discovery'', as well as Terry Stouch for both his infinite patience and inspiring many of the ideas in this work.
The authors are especially grateful to Cosma Shalizi for presenting a clear and lucid overview of the bootstrap principle to this audience, and we hope this contribution can further aid readers in the community in employing these principles in their work.
The authors further acknowledge Adrienne Chow and Anthony Lozada of Tecan US for a great deal of assistance in understanding the nature of operation and origin of errors in automated liquid handling equipment.
The authors thank Paul Czodrowski (Merck Darmstadt) for introducing us to IPython notebooks as a means of interactive knowledge transfer.
JDC and SMH acknowledge support from the Sloan Kettering Institute, a Louis V.~Gerstner Young Investigator Award, and NIH grant P30 CA008748.
SE acknowledges Joe Olechno and Antony Williams for extensive discussions on the topic, as well as the many scientists that responded to the various blog posts mentioned herein.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CONFLICTS OF INTEREST
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conflicts of interest}
\label{section:conflicts-of-interest}

The authors acknowledge no conflicts of interest, but wish to disclose that JDC is on the Scientific Advisory Board of Schr\"{o}dinger and SE is an employee of Collaborative Drug Discovery.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BIBLIOGRAPHY
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{prsty} 
\bibliography{dispensing-errors.bib}


\end{document}
